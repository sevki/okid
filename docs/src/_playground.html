<script type="module">


    import init, { OkId } from './okid/okid.js';

    async function run() {
        await init();
        window.OkId = OkId;
    }

    window.createIds = function () {
        const input = document.getElementById('input').value;
        const encoder = new TextEncoder();
        const data = encoder.encode(input);

        const results = document.getElementById('results');
        results.innerHTML = '';

        // Create SHA256 OkId
        const sha256Id = OkId.fromSha256(data);
        results.innerHTML += `<p>SHA256: ${sha256Id.toString()}</p>`;

        // Create Blake3 OkId
        const blake3Id = OkId.fromBlake3(data);
        results.innerHTML += `<p>Blake3: ${blake3Id.toString()}</p>`;

        // Create fingerprint
        const fingerprintId = OkId.fingerprint(data);
        results.innerHTML += `<p>Fingerprint: ${fingerprintId.toString()}</p>`;

        // Create UUID
        const uuidId = OkId.newUuid();
        results.innerHTML += `<p>UUID: ${uuidId.toString()}</p>`;

        // Create ULID
        const ulidId = OkId.newUlid();
        results.innerHTML += `<p>ULID: ${ulidId.toString()}</p>`;

        // Parse and convert to path-safe
        const parsed = OkId.fromString(sha256Id.toString());
        results.innerHTML += `<p>Path-safe: ${parsed.toPathSafe()}</p>`;
    }

    window.displaySafe = function () {
        const input = document.getElementById('secretInput').value;
        const resultDiv = document.getElementById('fromDisplaySafeResult');
        
        try {
            const okid = OkId.from_display_safe(input);
            resultDiv.innerHTML = `<p style="color: green;">OkId: ${okid.toString()}</p>`;
        } catch (error) {
            resultDiv.innerHTML = `<p style="color: red;">Invalid OkId format: ${error.message}</p>`;
        }
    }

    window.toDisplaySafe = function () {
        const okidInput = document.getElementById('okidInput').value;
        const resultDiv = document.getElementById('toDisplaySafeResult');
        
        try {
            const okidInstance = OkId.fromString(okidInput);
            const displaySafe = okidInstance.display_safe();
            resultDiv.innerHTML = `<p style="color: green;">Display-safe: ${displaySafe}</p>`;
        } catch (error) {
            resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
        }
    }


    run();
</script>

<div>
    <div>
        <h2>Create OkIds</h2>
        <input type="text" id="input" value="Hello, World!" />
        <button onclick="createIds()">Create IDs</button>
        <div id="results"></div>
    </div>
    <div>
        <h2>OkSecret</h2>
        <h3>From Display Safe</h3>
        <input type="text" id="secretInput" value="" placeholder="Enter an OkId string" />
        <button onclick="displaySafe()">Parse OkId</button>
        <div id="fromDisplaySafeResult"></div>
        <h3>To Display Safe</h3>
        <input type="text" id="okidInput" value="" placeholder="Enter an OkId string" />
        <button onclick="toDisplaySafe()">Convert to Display Safe</button>
        <div id="toDisplaySafeResult"></div>
    </div>

</div>